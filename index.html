<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Å–∏–Ω—Ç–∞–Ω - –ó–∞–º–µ—Ç–∫–∏ —Å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8b6cef;
            --secondary-color: #6c5ce7;
            --accent-color: #ff6b6b;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --background-color: #0f0f23;
            --sidebar-color: #1a1a2e;
            --card-color: #252542;
            --text-color: #ffffff;
            --text-secondary: #a0a0c0;
            --border-color: #3a3a5e;
            --hover-color: #2d2d4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo i {
            font-size: 24px;
            color: var(--primary-color);
        }

        .logo h1 {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-section {
            margin-bottom: 30px;
        }

        .nav-section h3 {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: none;
            border: none;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            text-align: left;
            font-size: 15px;
            font-weight: 500;
        }

        .nav-btn:hover {
            background-color: var(--hover-color);
            transform: translateX(5px);
        }

        .nav-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(139, 108, 239, 0.3);
        }

        .nav-btn i {
            width: 20px;
            text-align: center;
        }

        .btn {
            padding: 10px 16px;
            background-color: var(--card-color);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 500;
            width: 100%;
        }

        .btn:hover {
            background-color: var(--hover-color);
            transform: translateY(-1px);
        }

        .btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .note-item {
            padding: 12px 16px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-left: 3px solid transparent;
            font-size: 14px;
        }

        .note-item:hover {
            background-color: rgba(139, 108, 239, 0.1);
            border-left-color: var(--primary-color);
            transform: translateX(5px);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background-color: rgba(139, 108, 239, 0.15);
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tag:hover {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-item span {
            display: block;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .stat-item small {
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--sidebar-color);
        }

        .search-box {
            display: flex;
            align-items: center;
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 10px 20px;
            width: 400px;
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            box-shadow: 0 0 0 2px rgba(139, 108, 239, 0.3);
        }

        .search-box i {
            color: var(--text-secondary);
            margin-right: 12px;
        }

        .search-box input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 15px;
            outline: none;
            font-weight: 500;
        }

        .search-box input::placeholder {
            color: var(--text-secondary);
        }

        .user-info {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: linear-gradient(135deg, rgba(139, 108, 239, 0.05) 0%, transparent 100%);
        }

        /* –î–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
        .welcome-section {
            max-width: 1000px;
            margin: 0 auto;
        }

        .welcome-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background-color: var(--card-color);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .welcome-header h2 {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .welcome-header p {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .action-card {
            background-color: var(--card-color);
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .action-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 25px rgba(139, 108, 239, 0.2);
        }

        .action-card i {
            font-size: 40px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .action-card h3 {
            margin-bottom: 8px;
            font-size: 18px;
            color: var(--text-color);
        }

        .action-card p {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .recent-notes-section {
            margin-top: 40px;
        }

        .recent-notes-section h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        /* –†–µ–¥–∞–∫—Ç–æ—Ä */
        .editor-container {
            max-width: 900px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .editor-header {
            margin-bottom: 25px;
        }

        #note-title {
            width: 100%;
            padding: 20px;
            background-color: var(--card-color);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-color);
            font-size: 28px;
            font-weight: 700;
            outline: none;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            font-family: 'Inter', sans-serif;
        }

        #note-title:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(139, 108, 239, 0.2);
        }

        #note-tags {
            width: 100%;
            padding: 16px 20px;
            background-color: var(--card-color);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-color);
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        #note-tags:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(139, 108, 239, 0.2);
        }

        .editor-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .editor-actions .btn {
            width: auto;
            padding: 10px 18px;
            font-size: 14px;
        }

        #editor {
            min-height: 500px;
            width: 100%;
            padding: 30px;
            background-color: var(--card-color);
            border-radius: 16px;
            color: var(--text-color);
            font-size: 16px;
            line-height: 1.8;
            outline: none;
            border: 2px solid transparent;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            transition: all 0.3s ease;
        }

        #editor:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(139, 108, 239, 0.2);
        }

        /* –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–º–µ—Ç–∫–∏ */
        .note-view {
            max-width: 800px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        .note-view-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .note-view-header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--primary-color);
            line-height: 1.3;
        }

        .note-meta {
            display: flex;
            gap: 20px;
            color: var(--text-secondary);
            font-size: 14px;
            align-items: center;
            flex-wrap: wrap;
        }

        .note-content {
            background-color: var(--card-color);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            line-height: 1.8;
            border: 1px solid var(--border-color);
        }

        .note-content h1 {
            font-size: 28px;
            margin: 25px 0 15px 0;
            color: var(--primary-color);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .note-content h2 {
            font-size: 24px;
            margin: 20px 0 12px 0;
            color: var(--text-color);
        }

        .note-content h3 {
            font-size: 20px;
            margin: 18px 0 10px 0;
            color: var(--text-color);
        }

        .note-content p {
            margin-bottom: 18px;
            color: var(--text-color);
        }

        .note-content ul, .note-content ol {
            margin-left: 25px;
            margin-bottom: 18px;
            color: var(--text-color);
        }

        .note-content li {
            margin-bottom: 8px;
        }

        .internal-link {
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 2px solid rgba(139, 108, 239, 0.3);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .internal-link:hover {
            background-color: rgba(139, 108, 239, 0.1);
            border-bottom-color: var(--primary-color);
        }

        .broken-link {
            color: var(--accent-color);
            text-decoration: line-through;
            cursor: not-allowed;
            padding: 2px 4px;
            border-radius: 4px;
            background-color: rgba(255, 107, 107, 0.1);
        }

        .note-image {
            max-width: 100%;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .note-image:hover {
            transform: scale(1.01);
            border-color: var(--primary-color);
        }

        .note-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .note-actions .btn {
            width: auto;
            padding: 10px 18px;
            font-size: 14px;
        }

        /* –ì—Ä–∞—Ñ —Å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º */
        .graph-page {
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .graph-container {
            flex: 1;
            width: 100%;
            background-color: var(--card-color);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            position: relative;
            cursor: default;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .graph-container canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ */
        .graph-page:fullscreen {
            background-color: var(--background-color);
            padding: 20px;
        }

        .graph-page:fullscreen .graph-container {
            border-radius: 8px;
            border-width: 2px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .graph-page:fullscreen .graph-controls {
            background-color: rgba(37, 37, 66, 0.9);
            backdrop-filter: blur(10px);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .graph-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .graph-controls .btn {
            width: auto;
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 6px;
        }

        .graph-controls .btn i {
            margin-right: 6px;
            font-size: 12px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —É–∑–ª–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .dragging {
            animation: pulse 1s infinite;
            filter: drop-shadow(0 0 12px rgba(139, 108, 239, 0.8));
        }

        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∞ */
        .graph-instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(10, 10, 20, 0.85);
            color: var(--text-secondary);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 11px;
            max-width: 260px;
            z-index: 10;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .graph-instructions h4 {
            color: var(--primary-color);
            margin-bottom: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .graph-instructions ul {
            margin: 0;
            padding-left: 18px;
        }

        .graph-instructions li {
            margin-bottom: 3px;
            line-height: 1.3;
        }

        .close-instructions {
            position: absolute;
            top: 5px;
            right: 6px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            padding: 0;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-instructions:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è */
        .fullscreen-graph .graph-container {
            border: 2px solid var(--primary-color);
        }

        .fullscreen-graph .graph-controls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background-color: rgba(26, 26, 46, 0.95);
            border: 1px solid var(--primary-color);
            box-shadow: 0 5px 20px rgba(139, 108, 239, 0.3);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .fullscreen-graph .graph-instructions {
            bottom: 15px;
            left: 15px;
            font-size: 10px;
            max-width: 220px;
            background-color: rgba(10, 10, 20, 0.9);
        }

        /* –ü–æ–∏—Å–∫ */
        .search-page {
            max-width: 800px;
            margin: 0 auto;
        }

        .search-header {
            margin-bottom: 30px;
        }

        .search-results-count {
            color: var(--text-secondary);
            margin-top: 10px;
            font-size: 14px;
        }

        .search-result-item {
            background-color: var(--card-color);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .search-result-item:hover {
            transform: translateY(-3px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 25px rgba(139, 108, 239, 0.2);
        }

        .search-result-item h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 20px;
        }

        .search-result-item .preview {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.6;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--sidebar-color);
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 28px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: var(--accent-color);
        }

        .help-content {
            margin-top: 20px;
        }

        .help-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .help-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .help-section h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .help-section p {
            color: var(--text-color);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .help-section pre {
            background-color: var(--card-color);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            color: var(--text-secondary);
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .help-section ul {
            margin-left: 20px;
            color: var(--text-color);
        }

        .help-section li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 12px 20px;
            background-color: var(--success-color);
            color: white;
            border-radius: 8px;
            z-index: 1001;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
            animation-fill-mode: forwards;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            font-size: 13px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 60vh;
            }
            
            .top-bar {
                padding: 15px;
            }
            
            .search-box {
                width: 100%;
                max-width: 300px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .notes-grid {
                grid-template-columns: 1fr;
            }
            
            .graph-container {
                height: 400px;
            }
            
            .graph-controls {
                flex-direction: column;
            }
            
            .graph-controls .btn {
                width: 100%;
            }
            
            .graph-instructions {
                max-width: 200px;
                font-size: 11px;
                padding: 10px;
            }
        }

        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞ –≤ –ø–æ–ª–Ω–æ–º —ç–∫—Ä–∞–Ω–µ */
        @media (min-width: 1200px) {
            .graph-page:fullscreen .graph-container canvas {
                filter: drop-shadow(0 0 2px rgba(139, 108, 239, 0.3));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="logo">
                <i class="fas fa-gem"></i>
                <h1>–û—Å–∏–Ω—Ç–∞–Ω</h1>
            </div>
            
            <div class="nav-section">
                <button id="home-btn" class="nav-btn active">
                    <i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è
                </button>
                <button id="new-note-btn" class="nav-btn">
                    <i class="fas fa-plus-circle"></i> –ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞
                </button>
                <button id="graph-btn" class="nav-btn">
                    <i class="fas fa-project-diagram"></i> –ì—Ä–∞—Ñ
                </button>
                <button id="search-btn" class="nav-btn">
                    <i class="fas fa-search"></i> –ü–æ–∏—Å–∫
                </button>
            </div>
            
            <div class="nav-section">
                <h3><i class="fas fa-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏</h3>
                <div id="recent-notes" class="notes-list">
                    <!-- –ó–∞–º–µ—Ç–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <div class="nav-section">
                <h3><i class="fas fa-tags"></i> –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏</h3>
                <div id="popular-tags" class="tags-container">
                    <!-- –¢–µ–≥–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <div class="nav-section">
                <button id="export-btn" class="btn">
                    <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
                </button>
                <button id="import-btn" class="btn">
                    <i class="fas fa-upload"></i> –ò–º–ø–æ—Ä—Ç
                </button>
                <input type="file" id="import-file" accept=".json" style="display: none;">
                <button id="help-btn" class="btn">
                    <i class="fas fa-question-circle"></i> –ü–æ–º–æ—â—å
                </button>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <span id="total-notes">2</span>
                    <small>–ó–∞–º–µ—Ç–æ–∫</small>
                </div>
                <div class="stat-item">
                    <span id="total-links">1</span>
                    <small>–°–≤—è–∑–µ–π</small>
                </div>
                <div class="stat-item">
                    <span id="total-tags">2</span>
                    <small>–¢–µ–≥–æ–≤</small>
                </div>
            </div>
        </nav>
        
        <main class="main-content">
            <div class="top-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–º–µ—Ç–∫–∞–º... (–Ω–∞–∂–º–∏—Ç–µ Enter)">
                </div>
                <div class="user-info">
                    <span id="current-date"></span>
                </div>
            </div>
            
            <div id="content-area" class="content-area">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                <div class="welcome-section">
                    <div class="welcome-header">
                        <h2><i class="fas fa-gem"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Å–∏–Ω—Ç–∞–Ω!</h2>
                        <p>–ü—Ä–æ—Å—Ç–∞—è –∏ –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫ —Å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏.</p>
                    </div>
                    
                    <div class="quick-actions">
                        <div class="action-card" id="quick-new-note">
                            <i class="fas fa-plus-circle"></i>
                            <h3>–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</h3>
                            <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É</p>
                        </div>
                        <div class="action-card" id="quick-graph">
                            <i class="fas fa-project-diagram"></i>
                            <h3>–ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π</h3>
                            <p>–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∏</p>
                        </div>
                        <div class="action-card" id="quick-tutorial">
                            <i class="fas fa-graduation-cap"></i>
                            <h3>–û–±—É—á–µ–Ω–∏–µ</h3>
                            <p>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</p>
                        </div>
                        <div class="action-card" id="quick-daily">
                            <i class="fas fa-calendar-day"></i>
                            <h3>–î–Ω–µ–≤–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞</h3>
                            <p>–ó–∞–º–µ—Ç–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</p>
                        </div>
                    </div>
                    
                    <div class="recent-notes-section">
                        <h3><i class="fas fa-history"></i> –ù–µ–¥–∞–≤–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏</h3>
                        <div id="home-recent-notes" class="notes-grid">
                            <!-- –ó–∞–º–µ—Ç–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏ -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="fas fa-question-circle"></i> –ü–æ–º–æ—â—å –ø–æ –û—Å–∏–Ω—Ç–∞–Ω—É</h2>
            <div class="help-content">
                <div class="help-section">
                    <h3><i class="fas fa-link"></i> –ü–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                    <p>—á—Ç–æ–±—ã —Å–≤—è–∑–∞—Ç—å –∑–∞—Ü–µ–ø–∫–∏ [[–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞—Ü–µ–ø–∫–∏]]</p>
                    <pre>[[–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞—Ü–µ–ø–∫–∏]]</pre>
                    <p>–°—Å—ã–ª–∫–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –≤ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏.</p>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-camera"></i> –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ</h3>
                    <p>–í –≥—Ä–∞—Ñ–µ —Å–≤—è–∑–µ–π –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É —Å —Ñ–æ—Ç–æ" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.</p>
                    <p>–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞ —Å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–º —Ñ–æ—Ç–æ.</p>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-project-diagram"></i> –ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π</h3>
                    <p><strong>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–∑–µ–ª</strong> - —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–º–µ—Ç–∫—É</p>
                    <p><strong>–ó–∞–∂–º–∏—Ç–µ –õ–ö–ú –Ω–∞ —É–∑–ª–µ</strong> - —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –µ–≥–æ</p>
                    <p><strong>–ó–∞–∂–º–∏—Ç–µ –ü–ö–ú –∏ –¥–≤–∏–≥–∞–π—Ç–µ</strong> - —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –≤–µ—Å—å –≥—Ä–∞—Ñ</p>
                    <p><strong>–ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–æ–ª–µ—Å–∏–∫–∞</strong> - —á—Ç–æ–±—ã –ø—Ä–∏–±–ª–∏–∂–∞—Ç—å/–æ—Ç–¥–∞–ª—è—Ç—å</p>
                    <p><strong>–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫</strong> - —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ</p>
                    <p><strong>–ö–Ω–æ–ø–∫–∞ "R"</strong> - —Å–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ —É–∑–ª–æ–≤</p>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-keyboard"></i> –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h3>
                    <ul>
                        <li><strong>Ctrl + N</strong> - –ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</li>
                        <li><strong>Ctrl + F</strong> - –ü–æ–∏—Å–∫</li>
                        <li><strong>Ctrl + S</strong> - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</li>
                        <li><strong>Escape</strong> - –í—ã–π—Ç–∏ –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</li>
                        <li><strong>R</strong> - –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –≥—Ä–∞—Ñ–∞</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∞ -->
    <div id="graph-instructions" class="graph-instructions" style="display: none;">
        <button class="close-instructions">&times;</button>
        <h4>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–æ–º:</h4>
        <ul>
            <li><strong>–ö–ª–∏–∫</strong> - –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–º–µ—Ç–∫—É</li>
            <li><strong>–õ–ö–ú + –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ</strong> - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —É–∑–µ–ª</li>
            <li><strong>–ü–ö–ú + –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ</strong> - –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
            <li><strong>–ö–æ–ª–µ—Å–∏–∫–æ</strong> - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
            <li><strong>–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫</strong> - —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ</li>
            <li><strong>R</strong> - —Å–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ —É–∑–ª–æ–≤</li>
        </ul>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫ –û—Å–∏–Ω—Ç–∞–Ω
        class ObsidianApp {
            constructor() {
                this.notes = this.loadNotes();
                this.images = this.loadImages();
                this.currentNoteId = null;
                this.graphNodes = [];
                this.draggingNode = null;
                this.dragOffset = { x: 0, y: 0 };
                this.isDragging = false;
                this.nodePositions = this.loadNodePositions();
                this.isFullscreen = false;
                this.graphScale = 1.0;
                this.init();
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            init() {
                this.bindEvents();
                this.updateStats();
                this.updateRecentNotes();
                this.updatePopularTags();
                this.updateCurrentDate();
                this.setupKeyboardShortcuts();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
                this.showHomePage();
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∑–∏—Ü–∏–π —É–∑–ª–æ–≤
            loadNodePositions() {
                const saved = localStorage.getItem('obsidianNodePositions');
                return saved ? JSON.parse(saved) : {};
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —É–∑–ª–æ–≤
            saveNodePositions() {
                localStorage.setItem('obsidianNodePositions', JSON.stringify(this.nodePositions));
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —É–∑–ª–∞
            getNodePosition(noteId) {
                if (this.nodePositions[noteId]) {
                    return this.nodePositions[noteId];
                }
                return null;
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ —É–∑–ª–∞
            setNodePosition(noteId, x, y) {
                this.nodePositions[noteId] = { x, y };
                this.saveNodePositions();
            }
            
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π —É–∑–ª–æ–≤
            resetNodePositions() {
                this.nodePositions = {};
                this.saveNodePositions();
                if (document.querySelector('.graph-container')) {
                    this.renderGraph();
                }
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–º–µ—Ç–æ–∫ –∏–∑ localStorage
            loadNotes() {
                const saved = localStorage.getItem('obsidianNotes');
                if (saved) {
                    try {
                        return JSON.parse(saved);
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫:', e);
                        return this.getDemoNotes();
                    }
                }
                return this.getDemoNotes();
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            loadImages() {
                const saved = localStorage.getItem('obsidianImages');
                return saved ? JSON.parse(saved) : {};
            }
            
            // –î–µ–º–æ –∑–∞–º–µ—Ç–∫–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞
            getDemoNotes() {
                return [
                    {
                        id: '1',
                        title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Å–∏–Ω—Ç–∞–Ω',
                        content: `# –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Å–∏–Ω—Ç–∞–Ω! üåü

–≠—Ç–æ –≤–∞—à–∞ –ø–µ—Ä–≤–∞—è –∑–∞–º–µ—Ç–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –û—Å–∏–Ω—Ç–∞–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ–º –∏ –º–æ—â–Ω–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫ —Å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏.

##  –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫** - –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å
2. **–ü–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [[–¥–≤–æ–π–Ω—ã–µ —Å–∫–æ–±–∫–∏]] –¥–ª—è —Å—Å—ã–ª–æ–∫ –º–µ–∂–¥—É –∑–∞–º–µ—Ç–∫–∞–º–∏
3. **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫ –∑–∞–º–µ—Ç–∫–∞–º
4. **–ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π** - –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–º–µ—Ç–∫–∞–º–∏
5. **–ü–æ–∏—Å–∫** - –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

##  –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≥—Ä–∞—Ñ–æ–º:

- **–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–∑–µ–ª** - —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–º–µ—Ç–∫—É
- **–ó–∞–∂–º–∏—Ç–µ –õ–ö–ú –Ω–∞ —É–∑–ª–µ** - —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –µ–≥–æ
- **–ó–∞–∂–º–∏—Ç–µ –ü–ö–ú –∏ –¥–≤–∏–≥–∞–π—Ç–µ** - —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –≤–µ—Å—å –≥—Ä–∞—Ñ
- **–ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–æ–ª–µ—Å–∏–∫–∞** - —á—Ç–æ–±—ã –ø—Ä–∏–±–ª–∏–∂–∞—Ç—å/–æ—Ç–¥–∞–ª—è—Ç—å
- **–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫** - —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ

##  –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫:

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–ú–æ–∏ –∏–¥–µ–∏", –∞ –∑–∞—Ç–µ–º —Å—Å—ã–ª–∞–π—Ç–µ—Å—å –Ω–∞ –Ω–µ–µ —Ç–∞–∫: [[–ú–æ–∏ –∏–¥–µ–∏]]

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å [[–í—Ç–æ—Ä–∞—è –∑–∞–º–µ—Ç–∫–∞]] –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —Å–≤—è–∑–∏.

---
*–°–æ–∑–¥–∞–Ω–æ: ${new Date().toLocaleDateString('ru-RU')}*`,
                        tags: ['–¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å', '–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', '–¥–µ–º–æ'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: '2',
                        title: '–í—Ç–æ—Ä–∞—è –∑–∞–º–µ—Ç–∫–∞',
                        content: `# –í—Ç–æ—Ä–∞—è –∑–∞–º–µ—Ç–∫–∞ 

–≠—Ç–∞ –∑–∞–º–µ—Ç–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å [[–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Å–∏–Ω—Ç–∞–Ω]].

##  –°–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–º–µ—Ç–∫–∞–º–∏

–ö–æ–≥–¥–∞ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ [[–¥–≤–æ–π–Ω—ã–µ —Å–∫–æ–±–∫–∏]], —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–º–µ—Ç–∫–∞–º–∏. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Ç—å –∑–Ω–∞–Ω–∏–π –∏ –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

##  –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —É–∑–ª–æ–≤ –≤ –≥—Ä–∞—Ñ–µ

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å —É–∑–ª—ã –≤ –≥—Ä–∞—Ñ–µ! –ü—Ä–æ—Å—Ç–æ –∑–∞–∂–º–∏—Ç–µ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –Ω–∞ —É–∑–ª–µ –∏ –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –µ–≥–æ. –ü–æ–∑–∏—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

##  –¢–µ–≥–∏

–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–µ–≥–∏ –∫ –∑–∞–º–µ—Ç–∫–∞–º: #–ø—Ä–∏–º–µ—Ä #—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ #–æ—Å–∏–Ω—Ç–∞–Ω

–¢–µ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏ –ø–æ —Ç–µ–º–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.

##  –ò–¥–µ–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- –í–µ—Å—Ç–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã –∫–Ω–∏–≥ –∏ —Å—Ç–∞—Ç–µ–π
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –∏ –∑–∞–¥–∞—á–∏
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∏–¥–µ–∏
- –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –º—ã—Å–ª–∏ –∏ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è

---
*–°–æ–∑–¥–∞–Ω–æ: ${new Date().toLocaleDateString('ru-RU')}*`,
                        tags: ['–ø—Ä–∏–º–µ—Ä', '—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', '–¥–µ–º–æ'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
            saveNotes() {
                try {
                    localStorage.setItem('obsidianNotes', JSON.stringify(this.notes));
                    this.updateStats();
                    this.updateRecentNotes();
                    this.updatePopularTags();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫:', e);
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            saveImages() {
                localStorage.setItem('obsidianImages', JSON.stringify(this.images));
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateStats() {
                document.getElementById('total-notes').textContent = this.notes.length;
                
                // –°—á–∏—Ç–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–µ–π
                let totalLinks = 0;
                this.notes.forEach(note => {
                    const links = note.content.match(/\[\[(.*?)\]\]/g);
                    if (links) totalLinks += links.length;
                });
                document.getElementById('total-links').textContent = totalLinks;
                
                // –°—á–∏—Ç–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏
                const allTags = new Set();
                this.notes.forEach(note => {
                    note.tags.forEach(tag => allTags.add(tag));
                });
                document.getElementById('total-tags').textContent = allTags.size;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã
            updateCurrentDate() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('current-date').textContent = 
                    now.toLocaleDateString('ru-RU', options);
            }
            
            // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl+N - –Ω–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                        e.preventDefault();
                        this.showEditor();
                    }
                    
                    // Ctrl+F - –ø–æ–∏—Å–∫
                    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                        e.preventDefault();
                        this.showSearchPage();
                        document.getElementById('search-input').focus();
                    }
                    
                    // Ctrl+S - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        const saveBtn = document.getElementById('save-btn');
                        if (saveBtn) saveBtn.click();
                    }
                    
                    // Escape - –∑–∞–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏–ª–∏ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                    if (e.key === 'Escape') {
                        const editor = document.querySelector('.editor-container');
                        const modal = document.getElementById('help-modal');
                        
                        if (editor) {
                            this.showHomePage();
                        } else if (modal && modal.style.display === 'block') {
                            this.hideModal('help-modal');
                        }
                    }
                    
                    // R - —Å–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–π –≥—Ä–∞—Ñ–∞
                    if (e.key === 'r' && document.querySelector('.graph-container')) {
                        e.preventDefault();
                        this.resetNodePositions();
                        this.showNotification('–ü–æ–∑–∏—Ü–∏–∏ —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞ —Å–±—Ä–æ—à–µ–Ω—ã');
                    }
                    
                    // F11 –∏–ª–∏ F - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –≥—Ä–∞—Ñ–∞
                    if ((e.key === 'F11' || (e.key === 'f' && e.altKey)) && document.querySelector('.graph-container')) {
                        e.preventDefault();
                        this.toggleFullscreenGraph();
                    }
                    
                    // Enter –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏
                    if (e.key === 'Enter' && e.target.id === 'search-input') {
                        this.showSearchPage();
                        const query = e.target.value;
                        if (query.trim()) {
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∏—Å–∫–∞
                            setTimeout(() => {
                                const searchQuery = document.getElementById('search-page-input');
                                if (searchQuery) {
                                    searchQuery.value = query;
                                    this.performSearch(query);
                                }
                            }, 100);
                        }
                    }
                });
            }
            
            // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
            bindEvents() {
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                document.getElementById('home-btn').addEventListener('click', () => this.showHomePage());
                document.getElementById('new-note-btn').addEventListener('click', () => this.showEditor());
                document.getElementById('graph-btn').addEventListener('click', () => this.showGraphPage());
                document.getElementById('search-btn').addEventListener('click', () => this.showSearchPage());
                
                // –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                document.addEventListener('click', (e) => {
                    if (e.target.closest('#quick-new-note')) this.showEditor();
                    if (e.target.closest('#quick-graph')) this.showGraphPage();
                    if (e.target.closest('#quick-tutorial')) this.showHelpModal();
                    if (e.target.closest('#quick-daily')) this.createDailyNote();
                });
                
                // –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç
                document.getElementById('export-btn').addEventListener('click', () => this.exportNotes());
                document.getElementById('import-btn').addEventListener('click', () => {
                    document.getElementById('import-file').click();
                });
                document.getElementById('import-file').addEventListener('change', (e) => {
                    if (e.target.files[0]) this.importNotes(e.target.files[0]);
                });
                
                // –ü–æ–º–æ—â—å
                document.getElementById('help-btn').addEventListener('click', () => this.showHelpModal());
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                const closeBtn = document.querySelector('.close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        this.hideModal('help-modal');
                    });
                }
                
                // –ö–ª–∏–∫ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
                window.addEventListener('click', (e) => {
                    if (e.target.id === 'help-modal') {
                        this.hideModal('help-modal');
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
                document.addEventListener('fullscreenchange', () => {
                    this.isFullscreen = !!document.fullscreenElement;
                    if (document.querySelector('.graph-container')) {
                        this.handleFullscreenChange();
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
            handleFullscreenChange() {
                const graphPage = document.querySelector('.graph-page');
                if (this.isFullscreen) {
                    graphPage.classList.add('fullscreen-graph');
                    this.graphScale = 1.5; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
                    this.showNotification('–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –≥—Ä–∞—Ñ–∞. –ù–∞–∂–º–∏—Ç–µ F11 –∏–ª–∏ Esc –¥–ª—è –≤—ã—Ö–æ–¥–∞.');
                } else {
                    graphPage.classList.remove('fullscreen-graph');
                    this.graphScale = 1.0; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π –º–∞—Å—à—Ç–∞–±
                    this.showNotification('–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –≥—Ä–∞—Ñ–∞');
                }
                
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥—Ä–∞—Ñ —Å –Ω–æ–≤—ã–º –º–∞—Å—à—Ç–∞–±–æ–º
                setTimeout(() => {
                    this.renderGraph();
                }, 100);
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –≥—Ä–∞—Ñ–∞
            toggleFullscreenGraph() {
                const graphPage = document.querySelector('.graph-page');
                if (!graphPage) return;
                
                if (!document.fullscreenElement) {
                    if (graphPage.requestFullscreen) {
                        graphPage.requestFullscreen();
                    } else if (graphPage.webkitRequestFullscreen) {
                        graphPage.webkitRequestFullscreen();
                    } else if (graphPage.msRequestFullscreen) {
                        graphPage.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–º–µ—Ç–æ–∫
            updateRecentNotes() {
                const container = document.getElementById('recent-notes');
                const homeContainer = document.getElementById('home-recent-notes');
                
                if (!container && !homeContainer) return;
                
                const recent = [...this.notes]
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                    .slice(0, 8);
                
                const renderNoteItem = (note) => `
                    <div class="note-item" data-note-id="${note.id}">
                        <div style="font-weight: 600; margin-bottom: 4px;">${note.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${new Date(note.updatedAt).toLocaleDateString('ru-RU')}
                            ${note.tags.map(tag => `<span style="margin-left: 8px; color: var(--primary-color);">#${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                if (container) {
                    container.innerHTML = recent.slice(0, 5).map(renderNoteItem).join('');
                }
                
                if (homeContainer) {
                    homeContainer.innerHTML = recent.map(renderNoteItem).join('');
                }
                
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–∫–∞ –Ω–∞ –∑–∞–º–µ—Ç–∫–∏
                document.querySelectorAll('.note-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const noteId = e.currentTarget.dataset.noteId;
                        this.showNotePage(noteId);
                    });
                });
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–µ–≥–æ–≤
            updatePopularTags() {
                const container = document.getElementById('popular-tags');
                if (!container) return;
                
                // –°—á–∏—Ç–∞–µ–º —Ç–µ–≥–∏
                const tagCounts = {};
                this.notes.forEach(note => {
                    note.tags.forEach(tag => {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    });
                });
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
                const popularTags = Object.entries(tagCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10)
                    .map(([tag, count]) => ({ tag, count }));
                
                container.innerHTML = popularTags.map(tagInfo => 
                    `<div class="tag" data-tag="${tagInfo.tag}">${tagInfo.tag} (${tagInfo.count})</div>`
                ).join('');
                
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–∫–∞ –Ω–∞ —Ç–µ–≥–∏
                container.querySelectorAll('.tag').forEach(tag => {
                    tag.addEventListener('click', (e) => {
                        const tagName = e.currentTarget.dataset.tag;
                        this.showSearchPage();
                        setTimeout(() => {
                            const searchInput = document.getElementById('search-page-input');
                            if (searchInput) {
                                searchInput.value = `#${tagName}`;
                                this.performSearch(`#${tagName}`);
                            }
                        }, 100);
                    });
                });
            }
            
            // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                if (!notification) return;
                
                const colors = {
                    success: '#00b894',
                    error: '#ff6b6b',
                    warning: '#fdcb6e',
                    info: '#0984e3'
                };
                
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                    type === 'error' ? 'exclamation-circle' : 
                                    type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    ${message}
                `;
                notification.style.backgroundColor = colors[type] || colors.success;
                
                notification.style.display = 'block';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            // –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            showHomePage() {
                const content = document.getElementById('content-area');
                content.innerHTML = `
                    <div class="welcome-section">
                        <div class="welcome-header">
                            <h2><i class="fas fa-gem"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Å–∏–Ω—Ç–∞–Ω!</h2>
                            <p>–ü—Ä–æ—Å—Ç–∞—è –∏ –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫ —Å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏.</p>
                        </div>
                        
                        <div class="quick-actions">
                            <div class="action-card" id="quick-new-note">
                                <i class="fas fa-plus-circle"></i>
                                <h3>–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</h3>
                                <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É</p>
                            </div>
                            <div class="action-card" id="quick-graph">
                                <i class="fas fa-project-diagram"></i>
                                <h3>–ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π</h3>
                                <p>–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∏</p>
                            </div>
                            <div class="action-card" id="quick-tutorial">
                                <i class="fas fa-graduation-cap"></i>
                                <h3>–û–±—É—á–µ–Ω–∏–µ</h3>
                                <p>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</p>
                            </div>
                            <div class="action-card" id="quick-daily">
                                <i class="fas fa-calendar-day"></i>
                                <h3>–î–Ω–µ–≤–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞</h3>
                                <p>–ó–∞–º–µ—Ç–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</p>
                            </div>
                        </div>
                        
                        <div class="recent-notes-section">
                            <h3><i class="fas fa-history"></i> –ù–µ–¥–∞–≤–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏</h3>
                            <div id="home-recent-notes" class="notes-grid">
                                <!-- –ó–∞–º–µ—Ç–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>
                `;
                
                this.setActiveNav('home-btn');
                this.updateRecentNotes();
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏
            createDailyNote() {
                const today = new Date();
                const dateStr = today.toLocaleDateString('ru-RU', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const title = `–î–Ω–µ–≤–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞: ${dateStr}`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–º–µ—Ç–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
                const existingNote = this.notes.find(note => 
                    note.title.includes('–î–Ω–µ–≤–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞:') && 
                    note.createdAt.startsWith(today.toISOString().split('T')[0])
                );
                
                if (existingNote) {
                    this.showNotePage(existingNote.id);
                    this.showNotification('–ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–Ω–µ–≤–Ω–æ–π –∑–∞–º–µ—Ç–∫–µ');
                    return;
                }
                
                const template = `# ${dateStr}

## –ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- [ ] 
- [ ] 
- [ ] 

##  –ò–¥–µ–∏ –∏ –º—ã—Å–ª–∏
- 

##  –í—ã–ø–æ–ª–Ω–µ–Ω–æ
- 

##  –ó–∞–¥–∞—á–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
- 

##  –†–∞–∑–º—ã—à–ª–µ–Ω–∏—è
`;

                const newNote = {
                    id: Date.now().toString(),
                    title,
                    content: template,
                    tags: ['–¥–Ω–µ–≤–Ω–∞—è', today.getFullYear().toString(), '–ø–ª–∞–Ω'],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.notes.push(newNote);
                this.saveNotes();
                this.showEditor(newNote.id);
                this.showNotification('–°–æ–∑–¥–∞–Ω–∞ –¥–Ω–µ–≤–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞');
            }
            
            // –†–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–º–µ—Ç–æ–∫
            showEditor(noteId = null) {
                const note = noteId ? this.notes.find(n => n.id === noteId) : null;
                
                const content = document.getElementById('content-area');
                content.innerHTML = `
                    <div class="editor-container">
                        <div class="editor-header">
                            <input type="text" id="note-title" value="${note ? note.title : ''}" 
                                   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏" autocomplete="off">
                            <input type="text" id="note-tags" value="${note ? note.tags.join(', ') : ''}" 
                                   placeholder="–¢–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ä–∞–±–æ—Ç–∞, –∏–¥–µ–∏, –ø—Ä–æ–µ–∫—Ç)" autocomplete="off">
                        </div>
                        
                        <div class="editor-actions">
                            <button id="save-btn" class="btn primary" style="background-color: var(--primary-color);">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            ${note ? `
                                <button id="delete-btn" class="btn" style="background-color: var(--accent-color);">
                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                                <button id="view-btn" class="btn">
                                    <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                                </button>
                            ` : ''}
                            <button id="cancel-btn" class="btn">
                                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                        
                        <textarea id="editor" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å... –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [[–¥–≤–æ–π–Ω—ã–µ —Å–∫–æ–±–∫–∏]] –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –¥—Ä—É–≥–∏–µ –∑–∞–º–µ—Ç–∫–∏.">${note ? note.content : ''}</textarea>
                        
                        <div class="help-hint">
                            <p><i class="fas fa-lightbulb"></i> <strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [[–¥–≤–æ–π–Ω—ã–µ —Å–∫–æ–±–∫–∏]] –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫ –º–µ–∂–¥—É –∑–∞–º–µ—Ç–∫–∞–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä: [[–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏]]</p>
                        </div>
                    </div>
                `;
                
                this.setActiveNav('new-note-btn');
                this.bindEditorEvents(noteId);
                
                // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏
                if (!noteId) {
                    setTimeout(() => {
                        document.getElementById('note-title').focus();
                    }, 100);
                } else {
                    setTimeout(() => {
                        document.getElementById('editor').focus();
                    }, 100);
                }
            }
            
            // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            bindEditorEvents(noteId) {
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                document.getElementById('save-btn').addEventListener('click', () => {
                    this.saveNote(noteId);
                });
                
                // –£–¥–∞–ª–µ–Ω–∏–µ
                const deleteBtn = document.getElementById('delete-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', () => {
                        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–º–µ—Ç–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                            this.deleteNote(noteId);
                        }
                    });
                }
                
                // –ü—Ä–æ—Å–º–æ—Ç—Ä
                const viewBtn = document.getElementById('view-btn');
                if (viewBtn) {
                    viewBtn.addEventListener('click', () => {
                        if (noteId) {
                            this.showNotePage(noteId);
                        }
                    });
                }
                
                // –û—Ç–º–µ–Ω–∞
                document.getElementById('cancel-btn').addEventListener('click', () => {
                    if (noteId) {
                        this.showNotePage(noteId);
                    } else {
                        this.showHomePage();
                    }
                });
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
            saveNote(noteId) {
                const titleInput = document.getElementById('note-title');
                const contentInput = document.getElementById('editor');
                const tagsInput = document.getElementById('note-tags');
                
                const title = titleInput.value.trim();
                const content = contentInput.value;
                const tags = tagsInput.value
                    .split(',')
                    .map(tag => tag.trim())
                    .filter(tag => tag)
                    .slice(0, 10); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 10 —Ç–µ–≥–∞–º–∏
                
                if (!title) {
                    this.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏', 'error');
                    titleInput.focus();
                    return;
                }
                
                if (noteId) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–º–µ—Ç–∫–∏
                    const index = this.notes.findIndex(n => n.id === noteId);
                    if (index !== -1) {
                        this.notes[index] = {
                            ...this.notes[index],
                            title,
                            content,
                            tags,
                            updatedAt: new Date().toISOString()
                        };
                        this.showNotification('–ó–∞–º–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
                    }
                } else {
                    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏
                    const newNote = {
                        id: Date.now().toString(),
                        title,
                        content,
                        tags,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    this.notes.push(newNote);
                    noteId = newNote.id;
                    this.showNotification('–ó–∞–º–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞');
                }
                
                this.saveNotes();
                this.showNotePage(noteId);
            }
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
            deleteNote(noteId) {
                this.notes = this.notes.filter(note => note.id !== noteId);
                // –¢–∞–∫–∂–µ —É–¥–∞–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —É–∑–ª–∞, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                if (this.nodePositions[noteId]) {
                    delete this.nodePositions[noteId];
                    this.saveNodePositions();
                }
                this.saveNotes();
                this.showHomePage();
                this.showNotification('–ó–∞–º–µ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
            }
            
            // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–∫–∏
            showNotePage(noteId) {
                const note = this.notes.find(n => n.id === noteId);
                if (!note) {
                    this.showHomePage();
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                note.lastViewed = new Date().toISOString();
                
                const content = this.renderNoteContent(note.content);
                
                const contentArea = document.getElementById('content-area');
                contentArea.innerHTML = `
                    <div class="note-view">
                        <div class="note-view-header">
                            <h1>${note.title}</h1>
                            <div class="note-meta">
                                <span><i class="far fa-calendar"></i> –°–æ–∑–¥–∞–Ω–æ: ${new Date(note.createdAt).toLocaleDateString('ru-RU')}</span>
                                <span><i class="fas fa-history"></i> –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(note.updatedAt).toLocaleDateString('ru-RU')}</span>
                                <span><i class="fas fa-tags"></i> ${note.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ')}</span>
                            </div>
                        </div>
                        
                        <div class="note-content">
                            ${content}
                        </div>
                        
                        <div class="note-actions">
                            <button id="edit-note-btn" class="btn primary" style="background-color: var(--primary-color);">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button id="back-to-list-btn" class="btn">
                                <i class="fas fa-arrow-left"></i> –ö —Å–ø–∏—Å–∫—É
                            </button>
                            <button id="graph-from-note-btn" class="btn">
                                <i class="fas fa-project-diagram"></i> –ì—Ä–∞—Ñ
                            </button>
                        </div>
                    </div>
                `;
                
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
                document.getElementById('edit-note-btn').addEventListener('click', () => {
                    this.showEditor(noteId);
                });
                
                document.getElementById('back-to-list-btn').addEventListener('click', () => {
                    this.showHomePage();
                });
                
                document.getElementById('graph-from-note-btn').addEventListener('click', () => {
                    this.showGraphPage(noteId);
                });
                
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Å—ã–ª–∫–∞–º
                contentArea.querySelectorAll('.internal-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetTitle = e.target.dataset.title || e.target.textContent;
                        const targetNote = this.notes.find(n => 
                            n.title.toLowerCase() === targetTitle.toLowerCase()
                        );
                        if (targetNote) {
                            this.showNotePage(targetNote.id);
                        } else {
                            this.showNotification(`–ó–∞–º–µ—Ç–∫–∞ "${targetTitle}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`, 'warning');
                        }
                    });
                });
                
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                contentArea.querySelectorAll('.note-image').forEach(img => {
                    img.addEventListener('click', (e) => {
                        const imageUrl = e.target.src;
                        window.open(imageUrl, '_blank');
                    });
                });
            }
            
            // –†–µ–Ω–¥–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∑–∞–º–µ—Ç–∫–∏
            renderNoteContent(content) {
                if (!content) return '';
                
                let html = content;
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
                html = html.replace(/^## (.*$)/gm, '<h2>$1</h2>');
                html = html.replace(/^# (.*$)/gm, '<h1>$1</h1>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—É—Ä—Å–∏–≤–∞
                html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—á–µ—Ä–∫–Ω—É—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                html = html.replace(/~~(.*?)~~/g, '<del>$1</del>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∞
                html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞
                html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                html = html.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" class="note-image" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞">');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–æ–∫
                html = html.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
                html = html.replace(/\[\[(.*?)\]\]/g, (match, title) => {
                    const note = this.notes.find(n => 
                        n.title.toLowerCase() === title.toLowerCase()
                    );
                    if (note) {
                        return `<a href="#" class="internal-link" data-title="${title}">${title}</a>`;
                    } else {
                        return `<span class="broken-link" title="–ó–∞–º–µ—Ç–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞">${title}</span>`;
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–≥–æ–≤
                html = html.replace(/#(\w+)/g, '<span class="tag">#$1</span>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–∏—Ç–∞—Ç
                html = html.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π
                html = html.replace(/^---$/gm, '<hr>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∏—Å–∫–æ–≤
                html = html.replace(/^\s*[-*]\s+(.*$)/gm, '<li>$1</li>');
                html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤
                html = html.replace(/^\s*\d+\.\s+(.*$)/gm, '<li>$1</li>');
                html = html.replace(/(<li>.*<\/li>)/s, '<ol>$1</ol>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–æ–≤
                html = html.replace(/^- \[ \]\s+(.*$)/gm, '<li style="list-style-type: none;"><input type="checkbox"> $1</li>');
                html = html.replace(/^- \[x\]\s+(.*$)/gm, '<li style="list-style-type: none;"><input type="checkbox" checked> <s>$1</s></li>');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–±–∑–∞—Ü–µ–≤
                html = html.replace(/\n\n/g, '</p><p>');
                html = html.replace(/^\s*(.*)$/gm, '<p>$1</p>');
                
                // –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
                html = html.replace(/<p><\/p>/g, '');
                
                return html;
            }
            
            // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥—Ä–∞—Ñ–∞
            showGraphPage(highlightNoteId = null) {
                const content = document.getElementById('content-area');
                content.innerHTML = `
                    <div class="graph-page">
                        <h2 style="margin-bottom: 15px; color: var(--primary-color); font-size: 24px;">
                            <i class="fas fa-project-diagram"></i> –ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π
                        </h2>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 13px;">
                            –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –≤–∞—à–∏–º–∏ –∑–∞–º–µ—Ç–∫–∞–º–∏. 
                            <strong>–ö–ª–∏–∫–Ω–∏—Ç–µ</strong> –Ω–∞ —É–∑–µ–ª, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–º–µ—Ç–∫—É. 
                            <strong>–ó–∞–∂–º–∏—Ç–µ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ</strong> —É–∑–µ–ª, —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ.
                            <strong>F11</strong> –∏–ª–∏ <strong>Alt+F</strong> - –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω.
                        </p>
                        
                        <div class="graph-controls">
                            <button id="refresh-graph-btn" class="btn">
                                <i class="fas fa-redo"></i> –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                            <button id="add-photo-note-btn" class="btn" style="background-color: var(--accent-color);">
                                <i class="fas fa-camera"></i> –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                            </button>
                            <button id="reset-positions-btn" class="btn" style="background-color: var(--warning-color);">
                                <i class="fas fa-sync-alt"></i> –°–±—Ä–æ—Å–∏—Ç—å
                            </button>
                            <button id="fullscreen-graph-btn" class="btn" style="background-color: var(--primary-color);">
                                <i class="fas fa-expand"></i> –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω
                            </button>
                            <button id="center-graph-btn" class="btn">
                                <i class="fas fa-crosshairs"></i> –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                        
                        <div class="graph-container">
                            <canvas id="graph-canvas"></canvas>
                        </div>
                        
                        <div class="graph-stats" style="margin-top: 15px; color: var(--text-secondary); font-size: 12px;">
                            <p><i class="fas fa-info-circle"></i> 
                            –£–∑–ª–æ–≤: ${this.notes.length} | 
                            –°–≤—è–∑–µ–π: ${this.calculateTotalLinks()} | 
                            <strong>F11</strong> - –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω | <strong>R</strong> - —Å–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏
                            </p>
                        </div>
                    </div>
                `;
                
                this.setActiveNav('graph-btn');
                this.renderGraph(highlightNoteId);
                this.showGraphInstructions();
                
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
                document.getElementById('refresh-graph-btn').addEventListener('click', () => {
                    this.renderGraph();
                });
                
                document.getElementById('add-photo-note-btn').addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.multiple = true;
                    input.style.display = 'none';
                    input.addEventListener('change', (e) => {
                        if (e.target.files.length > 0) {
                            this.addNotesWithPhotos(Array.from(e.target.files));
                        }
                    });
                    document.body.appendChild(input);
                    input.click();
                    document.body.removeChild(input);
                });
                
                document.getElementById('reset-positions-btn').addEventListener('click', () => {
                    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞?')) {
                        this.resetNodePositions();
                    }
                });
                
                document.getElementById('fullscreen-graph-btn').addEventListener('click', () => {
                    this.toggleFullscreenGraph();
                });
                
                document.getElementById('center-graph-btn').addEventListener('click', () => {
                    this.centerGraph();
                });
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                this.setupGraphDragEvents();
            }
            
            // –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤—è–∑–µ–π
            calculateTotalLinks() {
                let totalLinks = 0;
                this.notes.forEach(note => {
                    const links = note.content.match(/\[\[(.*?)\]\]/g);
                    if (links) totalLinks += links.length;
                });
                return totalLinks;
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∞
            setupGraphDragEvents() {
                const canvas = document.getElementById('graph-canvas');
                if (!canvas) return;
                
                let isPanning = false;
                let panStart = { x: 0, y: 0 };
                let panOffset = { x: 0, y: 0 };
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —É–∑–ª–∞
                canvas.addEventListener('mousedown', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–ª–∏ –ª–∏ –≤ —É–∑–µ–ª
                    for (let node of this.graphNodes) {
                        const distance = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
                        if (distance <= node.radius) {
                            // –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —É–∑–ª–∞
                            this.draggingNode = node;
                            this.dragOffset.x = x - node.x;
                            this.dragOffset.y = y - node.y;
                            this.isDragging = true;
                            canvas.style.cursor = 'grabbing';
                            e.preventDefault();
                            return;
                        }
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ —É–∑–µ–ª, –Ω–∞—á–∏–Ω–∞–µ–º –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏)
                    if (e.button === 2) {
                        isPanning = true;
                        panStart.x = x;
                        panStart.y = y;
                        canvas.style.cursor = 'grabbing';
                        e.preventDefault();
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏
                canvas.addEventListener('mousemove', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    if (this.isDragging && this.draggingNode) {
                        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º —É–∑–µ–ª
                        this.draggingNode.x = x - this.dragOffset.x;
                        this.draggingNode.y = y - this.dragOffset.y;
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                        this.setNodePosition(this.draggingNode.id, this.draggingNode.x, this.draggingNode.y);
                        
                        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥—Ä–∞—Ñ
                        this.renderGraphNodes();
                        e.preventDefault();
                    } else if (isPanning) {
                        // –ü–∞–Ω–æ—Ä–∞–º–∏—Ä—É–µ–º –≤–µ—Å—å –≥—Ä–∞—Ñ
                        panOffset.x += x - panStart.x;
                        panOffset.y += y - panStart.y;
                        panStart.x = x;
                        panStart.y = y;
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –∫–æ –≤—Å–µ–º —É–∑–ª–∞–º
                        this.graphNodes.forEach(node => {
                            node.x += x - panStart.x;
                            node.y += y - panStart.y;
                            this.setNodePosition(node.id, node.x, node.y);
                        });
                        
                        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥—Ä–∞—Ñ
                        this.renderGraphNodes();
                        e.preventDefault();
                    } else {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∫—É—Ä—Å–æ—Ä –Ω–∞–¥ —É–∑–ª–æ–º
                        let overNode = false;
                        for (let node of this.graphNodes) {
                            const distance = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
                            if (distance <= node.radius) {
                                overNode = true;
                                break;
                            }
                        }
                        canvas.style.cursor = overNode ? 'grab' : 'default';
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –º—ã—à–∏
                canvas.addEventListener('mouseup', (e) => {
                    if (this.isDragging) {
                        this.isDragging = false;
                        this.draggingNode = null;
                        canvas.style.cursor = 'default';
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º—ã –Ω–µ –≤ –ø–æ–ª–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
                        if (!this.isFullscreen) {
                            this.showNotification('–ü–æ–∑–∏—Ü–∏—è —É–∑–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'info');
                        }
                    }
                    
                    if (isPanning) {
                        isPanning = false;
                        canvas.style.cursor = 'default';
                    }
                    
                    // –ö–ª–∏–∫ –ø–æ —É–∑–ª—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∑–∞–º–µ—Ç–∫–∏
                    if (e.button === 0 && !this.isDragging) {
                        const rect = canvas.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        
                        for (let node of this.graphNodes) {
                            const distance = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
                            if (distance <= node.radius) {
                                this.showNotePage(node.id);
                                break;
                            }
                        }
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞ –º—ã—à–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã canvas
                canvas.addEventListener('mouseleave', () => {
                    if (this.isDragging) {
                        this.isDragging = false;
                        this.draggingNode = null;
                    }
                    if (isPanning) {
                        isPanning = false;
                    }
                    canvas.style.cursor = 'default';
                });
                
                // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É - —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ
                canvas.addEventListener('dblclick', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–ø–∞–ª–∏ –ª–∏ –≤ —É–∑–µ–ª
                    let clickedNode = false;
                    for (let node of this.graphNodes) {
                        const distance = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
                        if (distance <= node.radius) {
                            clickedNode = true;
                            break;
                        }
                    }
                    
                    // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–µ –ø–æ —É–∑–ª—É, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≥—Ä–∞—Ñ
                    if (!clickedNode) {
                        this.centerGraph();
                    }
                });
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞ canvas (—á—Ç–æ–±—ã –ø—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏—è)
                canvas.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ª–µ—Å–∏–∫–∞ –º—ã—à–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                    const rect = canvas.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left;
                    const mouseY = e.clientY - rect.top;
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ –≤—Å–µ–º —É–∑–ª–∞–º
                    this.graphNodes.forEach(node => {
                        // –°–º–µ—â–∞–µ–º —É–∑–µ–ª –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                        node.x = mouseX + (node.x - mouseX) * zoomFactor;
                        node.y = mouseY + (node.y - mouseY) * zoomFactor;
                        this.setNodePosition(node.id, node.x, node.y);
                    });
                    
                    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥—Ä–∞—Ñ
                    this.renderGraphNodes();
                });
            }
            
            // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞
            centerGraph() {
                const canvas = document.getElementById('graph-canvas');
                if (!canvas || this.graphNodes.length === 0) return;
                
                // –ù–∞—Ö–æ–¥–∏–º –≥—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ—Ö —É–∑–ª–æ–≤
                let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
                this.graphNodes.forEach(node => {
                    minX = Math.min(minX, node.x);
                    maxX = Math.max(maxX, node.x);
                    minY = Math.min(minY, node.y);
                    maxY = Math.max(maxY, node.y);
                });
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –º–∞—Å—Å
                const centerX = (minX + maxX) / 2;
                const centerY = (minY + maxY) / 2;
                
                // –¶–µ–Ω—Ç—Ä canvas
                const canvasCenterX = canvas.width / 2;
                const canvasCenterY = canvas.height / 2;
                
                // –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
                const offsetX = canvasCenterX - centerX;
                const offsetY = canvasCenterY - centerY;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –∫–æ –≤—Å–µ–º —É–∑–ª–∞–º
                this.graphNodes.forEach(node => {
                    node.x += offsetX;
                    node.y += offsetY;
                    this.setNodePosition(node.id, node.x, node.y);
                });
                
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥—Ä–∞—Ñ
                this.renderGraphNodes();
                this.showNotification('–ì—Ä–∞—Ñ –æ—Ç—Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω', 'info');
            }
            
            // –ü–æ–∫–∞–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –≥—Ä–∞—Ñ–∞
            showGraphInstructions() {
                const instructions = document.getElementById('graph-instructions');
                if (instructions && !localStorage.getItem('graphInstructionsHidden')) {
                    instructions.style.display = 'block';
                    
                    // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
                    instructions.querySelector('.close-instructions').addEventListener('click', () => {
                        instructions.style.display = 'none';
                        localStorage.setItem('graphInstructionsHidden', 'true');
                    });
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        if (instructions.style.display === 'block') {
                            instructions.style.opacity = '0.7';
                        }
                    }, 8000);
                    
                    setTimeout(() => {
                        if (instructions.style.display === 'block') {
                            instructions.style.display = 'none';
                            localStorage.setItem('graphInstructionsHidden', 'true');
                        }
                    }, 10000);
                }
            }
            
            // –†–µ–Ω–¥–µ—Ä –≥—Ä–∞—Ñ–∞
            renderGraph(highlightNoteId = null) {
                const canvas = document.getElementById('graph-canvas');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const container = canvas.parentElement;
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
                const dpr = window.devicePixelRatio || 1;
                const rect = container.getBoundingClientRect();
                
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ DPI
                ctx.scale(dpr, dpr);
                canvas.style.width = `${rect.width}px`;
                canvas.style.height = `${rect.height}px`;
                
                // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –°–æ–∑–¥–∞–µ–º —É–∑–ª—ã —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
                this.createGraphNodes(highlightNoteId);
                
                // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ
                this.renderGraphNodes();
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞
            createGraphNodes(highlightNoteId = null) {
                this.graphNodes = [];
                const canvas = document.getElementById('graph-canvas');
                if (!canvas) return;
                
                // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
                const scale = this.graphScale;
                
                const centerX = canvas.width / (2 * window.devicePixelRatio || 1);
                const centerY = canvas.height / (2 * window.devicePixelRatio || 1);
                const radius = Math.min(canvas.width, canvas.height) * 0.2 / (window.devicePixelRatio || 1);
                
                // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —É–∑–ª—ã
                this.notes.forEach((note, index) => {
                    let x, y;
                    const savedPos = this.getNodePosition(note.id);
                    
                    if (savedPos) {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —Å —É—á–µ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞
                        x = savedPos.x * scale;
                        y = savedPos.y * scale;
                    } else {
                        // –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º –ø–æ –∫—Ä—É–≥—É —Å —É—á–µ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞
                        const angle = (index / this.notes.length) * 2 * Math.PI;
                        x = centerX + radius * Math.cos(angle) * scale;
                        y = centerY + radius * Math.sin(angle) * scale;
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                        this.setNodePosition(note.id, x, y);
                    }
                    
                    this.graphNodes.push({
                        id: note.id,
                        title: note.title,
                        x: x,
                        y: y,
                        radius: (note.id === highlightNoteId ? 35 : 
                               this.hasPhotos(note.id) ? 30 : 25) * scale,
                        color: note.id === highlightNoteId ? '#00b894' : 
                              (this.hasPhotos(note.id) ? '#ff6b6b' : '#8b6cef'),
                        isHighlighted: note.id === highlightNoteId,
                        scale: scale
                    });
                });
            }
            
            // –†–µ–Ω–¥–µ—Ä —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞
            renderGraphNodes() {
                const canvas = document.getElementById('graph-canvas');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const dpr = window.devicePixelRatio || 1;
                
                // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –†–∏—Å—É–µ–º —Å–≤—è–∑–∏
                this.drawGraphLinks(ctx);
                
                // –†–∏—Å—É–µ–º —É–∑–ª—ã
                this.drawGraphNodes(ctx);
            }
            
            // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –≥—Ä–∞—Ñ–∞
            drawGraphLinks(ctx) {
                // –°–Ω–∞—á–∞–ª–∞ —Ä–∏—Å—É–µ–º –≤—Å–µ —Å–≤—è–∑–∏
                this.notes.forEach(note => {
                    const sourceNode = this.graphNodes.find(n => n.id === note.id);
                    if (!sourceNode) return;
                    
                    const links = note.content.match(/\[\[(.*?)\]\]/g) || [];
                    links.forEach(link => {
                        const linkTitle = link.slice(2, -2);
                        const targetNote = this.notes.find(n => 
                            n.title.toLowerCase() === linkTitle.toLowerCase()
                        );
                        
                        if (targetNote) {
                            const targetNode = this.graphNodes.find(n => n.id === targetNote.id);
                            if (targetNode) {
                                // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é
                                ctx.beginPath();
                                ctx.moveTo(sourceNode.x, sourceNode.y);
                                ctx.lineTo(targetNode.x, targetNode.y);
                                
                                // –í—ã–±–∏—Ä–∞–µ–º —Ü–≤–µ—Ç –ª–∏–Ω–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É–∑–ª–æ–≤
                                let lineColor = 'rgba(139, 108, 239, 0.4)';
                                let lineWidth = 2 * this.graphScale;
                                
                                if (sourceNode.isHighlighted || targetNode.isHighlighted) {
                                    lineColor = 'rgba(0, 184, 148, 0.6)';
                                    lineWidth = 3 * this.graphScale;
                                } else if (this.hasPhotos(sourceNode.id) || this.hasPhotos(targetNode.id)) {
                                    lineColor = 'rgba(255, 107, 107, 0.4)';
                                }
                                
                                // –í –ø–æ–ª–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –¥–µ–ª–∞–µ–º –ª–∏–Ω–∏–∏ –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–º–∏
                                if (this.isFullscreen) {
                                    lineColor = lineColor.replace('0.4', '0.6').replace('0.6', '0.8');
                                    lineWidth *= 1.2;
                                }
                                
                                ctx.strokeStyle = lineColor;
                                ctx.lineWidth = lineWidth;
                                ctx.lineCap = 'round';
                                ctx.stroke();
                            }
                        }
                    });
                });
            }
            
            // –†–∏—Å–æ–≤–∞–Ω–∏–µ —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞
            drawGraphNodes(ctx) {
                this.graphNodes.forEach(node => {
                    // –†–∏—Å—É–µ–º —Ç–µ–Ω—å –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤
                    if (node.isHighlighted) {
                        ctx.beginPath();
                        ctx.arc(node.x, node.y, node.radius + 8 * this.graphScale, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(0, 184, 148, 0.3)';
                        ctx.fill();
                    }
                    
                    // –†–∏—Å—É–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —É–∑–ª–∞
                    const gradient = ctx.createRadialGradient(
                        node.x, node.y, 0,
                        node.x, node.y, node.radius
                    );
                    
                    if (node.isHighlighted) {
                        gradient.addColorStop(0, '#00b894');
                        gradient.addColorStop(0.7, '#00a085');
                        gradient.addColorStop(1, '#008b74');
                    } else if (this.hasPhotos(node.id)) {
                        gradient.addColorStop(0, '#ff6b6b');
                        gradient.addColorStop(0.7, '#ff5252');
                        gradient.addColorStop(1, '#ff3838');
                    } else {
                        gradient.addColorStop(0, '#8b6cef');
                        gradient.addColorStop(0.7, '#7a5be6');
                        gradient.addColorStop(1, '#6c5ce7');
                    }
                    
                    // –†–∏—Å—É–µ–º —Å–≤–µ—á–µ–Ω–∏–µ –¥–ª—è —É–∑–ª–æ–≤ –≤ –ø–æ–ª–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
                    if (this.isFullscreen) {
                        ctx.beginPath();
                        ctx.arc(node.x, node.y, node.radius + 5, 0, Math.PI * 2);
                        ctx.fillStyle = node.isHighlighted ? 'rgba(0, 184, 148, 0.2)' : 
                                      this.hasPhotos(node.id) ? 'rgba(255, 107, 107, 0.2)' : 
                                      'rgba(139, 108, 239, 0.2)';
                        ctx.fill();
                    }
                    
                    // –†–∏—Å—É–µ–º –∫—Ä—É–≥ —É–∑–ª–∞
                    ctx.beginPath();
                    ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // –†–∏—Å—É–µ–º –æ–±–≤–æ–¥–∫—É
                    ctx.strokeStyle = node.isHighlighted ? '#ffffff' : 'rgba(255, 255, 255, 0.9)';
                    ctx.lineWidth = node.isHighlighted ? 3 * this.graphScale : 2 * this.graphScale;
                    ctx.stroke();
                    
                    // –ò–∫–æ–Ω–∫–∞ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫ —Å —Ñ–æ—Ç–æ
                    if (this.hasPhotos(node.id)) {
                        ctx.fillStyle = '#ffffff';
                        ctx.font = `${16 * this.graphScale}px Arial`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText('üì∑', node.x, node.y);
                    }
                    
                    // –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
                    this.drawNodeLabel(ctx, node);
                });
            }
            
            // –†–∏—Å–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∫–∏ —É–∑–ª–∞
            drawNodeLabel(ctx, node) {
                const scale = this.graphScale;
                const fontSize = node.isHighlighted ? 14 * scale : 12 * scale;
                
                ctx.fillStyle = '#ffffff';
                ctx.font = `${node.isHighlighted ? 'bold ' : ''}${fontSize}px Inter, sans-serif`;
                ctx.textAlign = 'center';
                
                // –†–∞–∑–±–∏–≤–∞–µ–º –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏
                const maxLength = this.isFullscreen ? 20 : 15;
                let title = node.title;
                
                if (title.length > maxLength * 2) {
                    title = title.substring(0, maxLength * 2 - 3) + '...';
                }
                
                // –ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª–∏–Ω–Ω–æ–µ, —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏
                if (title.length > maxLength) {
                    const middle = Math.floor(title.length / 2);
                    let splitIndex = middle;
                    
                    // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π –ø—Ä–æ–±–µ–ª –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è
                    for (let i = 0; i < middle; i++) {
                        if (title[middle + i] === ' ') {
                            splitIndex = middle + i;
                            break;
                        }
                        if (title[middle - i] === ' ') {
                            splitIndex = middle - i;
                            break;
                        }
                    }
                    
                    const line1 = title.substring(0, splitIndex).trim();
                    const line2 = title.substring(splitIndex).trim();
                    
                    // –†–∏—Å—É–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É
                    ctx.fillText(line1, node.x, node.y + node.radius + 18 * scale);
                    // –†–∏—Å—É–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É
                    ctx.fillText(line2, node.x, node.y + node.radius + 36 * scale);
                } else {
                    // –†–∏—Å—É–µ–º –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
                    ctx.fillText(title, node.x, node.y + node.radius + 22 * scale);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —É –∑–∞–º–µ—Ç–∫–∏ —Ñ–æ—Ç–æ
            hasPhotos(noteId) {
                const note = this.notes.find(n => n.id === noteId);
                if (!note) return false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ–≥ —Ñ–æ—Ç–æ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                return note.tags.includes('—Ñ–æ—Ç–æ') || 
                       note.tags.includes('photo') || 
                       note.tags.includes('–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ') ||
                       note.content.includes('![') ||
                       note.content.includes('img') ||
                       note.content.includes('image');
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫ —Å —Ñ–æ—Ç–æ
            addNotesWithPhotos(files) {
                if (!files || files.length === 0) return;
                
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // –°–æ–∑–¥–∞–µ–º –∑–∞–º–µ—Ç–∫—É —Å —Ñ–æ—Ç–æ
                        const newNote = {
                            id: (Date.now() + index).toString(),
                            title: `–§–æ—Ç–æ: ${file.name.replace(/\.[^/.]+$/, '')}`,
                            content: `![${file.name}](${e.target.result})\n\n**–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:** ${new Date().toLocaleString()}\n\n**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫ —Ñ–æ—Ç–æ –∑–¥–µ—Å—å...`,
                            tags: ['—Ñ–æ—Ç–æ', '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', new Date().getFullYear().toString()],
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        };
                        
                        this.notes.push(newNote);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        const imageId = `img_${Date.now()}_${index}`;
                        this.images[imageId] = {
                            id: imageId,
                            noteId: newNote.id,
                            data: e.target.result,
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            uploadedAt: new Date().toISOString()
                        };
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        if (index === files.length - 1) {
                            this.saveNotes();
                            this.saveImages();
                            
                            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É —Ä—è–¥–æ–º —Å —Ü–µ–Ω—Ç—Ä–æ–º
                            const canvas = document.getElementById('graph-canvas');
                            if (canvas) {
                                const rect = canvas.getBoundingClientRect();
                                const x = rect.width / (2 * window.devicePixelRatio || 1) + (Math.random() - 0.5) * 150;
                                const y = rect.height / (2 * window.devicePixelRatio || 1) + (Math.random() - 0.5) * 150;
                                this.setNodePosition(newNote.id, x, y);
                            }
                            
                            this.showGraphPage(newNote.id);
                            this.showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${files.length} –∑–∞–º–µ—Ç–æ–∫ —Å —Ñ–æ—Ç–æ`);
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∏—Å–∫–∞
            showSearchPage() {
                const content = document.getElementById('content-area');
                content.innerHTML = `
                    <div class="search-page">
                        <div class="search-header">
                            <h2 style="color: var(--primary-color);">
                                <i class="fas fa-search"></i> –ü–æ–∏—Å–∫ –∑–∞–º–µ—Ç–æ–∫
                            </h2>
                            <div class="search-box" style="max-width: 100%; margin: 25px 0;">
                                <i class="fas fa-search"></i>
                                <input type="text" id="search-page-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –∏–ª–∏ —Ç–µ–≥–∞–º...">
                            </div>
                            <div class="search-results-count" id="search-results-count">
                                –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞
                            </div>
                        </div>
                        
                        <div id="search-results-container">
                            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                `;
                
                this.setActiveNav('search-btn');
                
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
                const searchInput = document.getElementById('search-page-input');
                searchInput.addEventListener('input', (e) => {
                    this.performSearch(e.target.value);
                });
                
                // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                setTimeout(() => {
                    searchInput.focus();
                }, 100);
            }
            
            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
            performSearch(query) {
                const resultsContainer = document.getElementById('search-results-container');
                const resultsCount = document.getElementById('search-results-count');
                
                if (!query.trim()) {
                    resultsContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞</h3>
                            <p>–ò—â–∏—Ç–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –∏–ª–∏ —Ç–µ–≥–∞–º –∑–∞–º–µ—Ç–æ–∫</p>
                        </div>
                    `;
                    resultsCount.textContent = '–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞';
                    return;
                }
                
                const lowerQuery = query.toLowerCase();
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–º–µ—Ç–∫–∏
                const results = this.notes.filter(note => {
                    // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                    if (note.title.toLowerCase().includes(lowerQuery)) return true;
                    
                    // –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é
                    if (note.content.toLowerCase().includes(lowerQuery)) return true;
                    
                    // –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º
                    if (note.tags.some(tag => tag.toLowerCase().includes(lowerQuery.replace('#', '')))) return true;
                    
                    // –ü–æ–∏—Å–∫ –ø–æ —Ç–æ—á–Ω–æ–º—É —Ç–µ–≥—É (–µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å #)
                    if (query.startsWith('#') && note.tags.some(tag => 
                        tag.toLowerCase() === lowerQuery.replace('#', ''))) return true;
                    
                    return false;
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                if (results.length === 0) {
                    resultsContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</p>
                        </div>
                    `;
                    resultsCount.textContent = `–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`;
                } else {
                    const resultsHtml = results.map(note => `
                        <div class="search-result-item" data-note-id="${note.id}">
                            <h3>${note.title}</h3>
                            <div class="preview">
                                ${this.getSearchPreview(note.content, query)}
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                                <div>
                                    ${note.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                                <div style="color: var(--text-secondary); font-size: 13px;">
                                    <i class="far fa-calendar"></i> ${new Date(note.updatedAt).toLocaleDateString('ru-RU')}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    resultsContainer.innerHTML = resultsHtml;
                    resultsCount.textContent = `–ù–∞–π–¥–µ–Ω–æ –∑–∞–º–µ—Ç–æ–∫: ${results.length}`;
                    
                    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
                    document.querySelectorAll('.search-result-item').forEach(item => {
                        item.addEventListener('click', () => {
                            const noteId = item.dataset.noteId;
                            this.showNotePage(noteId);
                        });
                    });
                }
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –¥–ª—è –ø–æ–∏—Å–∫–∞
            getSearchPreview(content, query) {
                const lowerContent = content.toLowerCase();
                const lowerQuery = query.toLowerCase();
                
                const index = lowerContent.indexOf(lowerQuery);
                if (index === -1) {
                    // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±–µ—Ä–µ–º –Ω–∞—á–∞–ª–æ —Ç–µ–∫—Å—Ç–∞
                    return content.substring(0, 200) + (content.length > 200 ? '...' : '');
                }
                
                // –ù–∞—Ö–æ–¥–∏–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º
                const start = Math.max(0, index - 50);
                const end = Math.min(content.length, index + query.length + 100);
                
                let preview = content.substring(start, end);
                if (start > 0) preview = '...' + preview;
                if (end < content.length) preview = preview + '...';
                
                // –í—ã–¥–µ–ª—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                preview = preview.replace(new RegExp(`(${query})`, 'gi'), '<mark style="background-color: rgba(255, 219, 107, 0.3); padding: 2px 0; border-radius: 3px;">$1</mark>');
                
                return preview;
            }
            
            // –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–º–µ—Ç–æ–∫
            exportNotes() {
                const data = {
                    notes: this.notes,
                    images: this.images,
                    nodePositions: this.nodePositions,
                    exportedAt: new Date().toISOString(),
                    version: '1.0'
                };
                
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `osintan-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('–ó–∞–º–µ—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
            }
            
            // –ò–º–ø–æ—Ä—Ç –∑–∞–º–µ—Ç–æ–∫
            importNotes(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${data.notes?.length || 0} –∑–∞–º–µ—Ç–æ–∫? –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–º–µ—Ç–∫–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.`)) {
                            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏ (–∏—Å–∫–ª—é—á–∞—è –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID)
                            if (data.notes && Array.isArray(data.notes)) {
                                data.notes.forEach(newNote => {
                                    const exists = this.notes.some(note => note.id === newNote.id);
                                    if (!exists) {
                                        this.notes.push(newNote);
                                    }
                                });
                            }
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            if (data.images && typeof data.images === 'object') {
                                Object.assign(this.images, data.images);
                            }
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ —É–∑–ª–æ–≤
                            if (data.nodePositions && typeof data.nodePositions === 'object') {
                                Object.assign(this.nodePositions, data.nodePositions);
                                this.saveNodePositions();
                            }
                            
                            this.saveNotes();
                            this.saveImages();
                            this.showHomePage();
                            this.showNotification('–ó–∞–º–µ—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
                        }
                    } catch (error) {
                        this.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞', 'error');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
            }
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏
            showHelpModal() {
                const modal = document.getElementById('help-modal');
                if (modal) {
                    modal.style.display = 'flex';
                }
            }
            
            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                }
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            setActiveNav(buttonId) {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ
                const activeBtn = document.getElementById(buttonId);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            window.obsidianApp = new ObsidianApp();
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
        window.addEventListener('beforeunload', () => {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            if (window.obsidianApp && document.querySelector('.graph-container')) {
                setTimeout(() => {
                    window.obsidianApp.renderGraph();
                }, 100);
            }
        });
    </script>
</body>
</html>
